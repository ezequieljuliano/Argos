<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets" template="/template/main.xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="body">
        <style type="text/css">
            .linha-pesquisa .nome-link {
                padding: 0px;
                margin: 0px;
                margin-bottom: 5px;
                font-size: medium;
            }
            .linha-pesquisa .nome-link a{
                color: #12C;
            }

            .linha-pesquisa .nome-link span {
                display: inline-block;
                text-indent: -999999px;
                overflow: hidden;
                width: 16px;
                height: 16px;
                margin-right: 5px;
            }
            .linha-pesquisa p {
                font-size: small;
                margin: 0px;
                margin-bottom: 3px;
            }
            .linha-pesquisa {
                padding: 5px;
                font-family: arial, sans-serif;
                margin-bottom: 10px;
                padding-bottom: 5px;
                color: #222;
                border-bottom: 1px solid #ddd;
            }
            .linha-pesquisa:hover {
                background-color: #f6f6f6;
            }
            .nivel1 {
                background-image: url(images/info.png);
            }
            .nivel2 {
                background-image: url(images/alerta.png);
            }
            .nivel3 {
                background-image: url(images/erro.png);
            }
            .nivel4 {
                background-image: url(images/debug.png);
            }
            .nivel5 {
                background-image: url(images/fatal.png);
            }
            .nivel6 {
                background-image: url(images/excecao.png);
            }
        </style>
        <h:form id="frm" rendered="#{securityContext.hasRole('N')}">

            <p:panel id="pnPesquisaAvancada" rendered="#{eventoPesquisaMB.pesquisaAvancada}">
                <h:panelGrid columns="3">
                    <h:panelGrid columns="1" rendered="#{securityContext.hasRole('A')}" >
                        <h:outputText value="Entidade:" />
                        <p:selectOneMenu converter="entidadeConverter" value="#{eventoPesquisaMB.selectedEntidade}" style="width: 350px">  
                            <f:selectItem itemLabel="Selecione..." itemValue="" /> 
                            <f:selectItems value="#{eventoPesquisaMB.entidadeList}" var="vEntidade" itemLabel="#{vEntidade.nome}" itemValue="#{vEntidade}"/>  
                        </p:selectOneMenu>
                    </h:panelGrid>

                    <h:panelGrid columns="1">    
                        <h:outputText value="Nível:" />
                        <p:selectOneMenu converter="eventoNivelConverter" value="#{eventoPesquisaMB.selectedEventoNivel}" style="width: 250px">  
                            <f:selectItem itemLabel="Selecione..." itemValue="" /> 
                            <f:selectItems value="#{eventoPesquisaMB.eventoNivelList}" var="vEventoNivel" itemLabel="#{vEventoNivel.descricao}" itemValue="#{vEventoNivel}"/>  
                        </p:selectOneMenu>
                    </h:panelGrid>

                    <h:panelGrid columns="1">       
                        <h:outputText value="Tipo:" />
                        <p:selectOneMenu converter="eventoTipoConverter" value="#{eventoPesquisaMB.selectedEventoTipo}" style="width: 250px">  
                            <f:selectItem itemLabel="Selecione..." itemValue="" /> 
                            <f:selectItems value="#{eventoPesquisaMB.eventoTipoList}" var="vEventoTipo" itemLabel="#{vEventoTipo.descricao}" itemValue="#{vEventoTipo}"/>  
                        </p:selectOneMenu>
                    </h:panelGrid>
                </h:panelGrid>

                <h:panelGrid columns="2">
                    <h:panelGrid columns="1" >
                        <h:outputText value="Pesquisar por:" />
                        <p:inputText value="#{eventoPesquisaMB.campoPesquisa}" style="width: 350px" id="campoPesquisa" />  
                    </h:panelGrid>

                    <h:panelGrid columns="1" >
                        <h:outputText value="Pesquisar em:" />
                        <p:selectOneMenu style="width: 250px" value="#{eventoPesquisaMB.tipoPesquisa}">  
                            <f:selectItems value="#{eventoPesquisaMB.tipoPesquisas}"/>
                        </p:selectOneMenu>  
                    </h:panelGrid>
                </h:panelGrid>
                
                <p:commandButton value="Pesquisar" action="#{eventoPesquisaMB.pesquisar()}" image="ui-icon ui-icon-circle-zoomin" update=":frm"/>
                <p:commandButton value="Básico" action="#{eventoPesquisaMB.inativarPesquisaAvancada()}" image="ui-icon ui-icon-carat-2-n-s" update=":frm" immediate="true"/> 
            </p:panel>

            <p:panel id="pnPesquisaBasica" rendered="#{not eventoPesquisaMB.pesquisaAvancada}">
                <h:panelGrid columns="2">
                    <h:panelGrid columns="1" >
                        <h:outputText value="Pesquisar por:" />
                        <p:inputText value="#{eventoPesquisaMB.campoPesquisa}" size="40"/>
                    </h:panelGrid>

                    <h:panelGrid columns="1" >
                        <h:outputText value="Pesquisar em:" />
                        <p:selectOneMenu style="width: 250px" value="#{eventoPesquisaMB.tipoPesquisa}">  
                            <f:selectItems value="#{eventoPesquisaMB.tipoPesquisas}"/>
                        </p:selectOneMenu>  
                    </h:panelGrid>
                </h:panelGrid>
                
                <p:commandButton value="Pesquisar" action="#{eventoPesquisaMB.pesquisar()}" image="ui-icon ui-icon-circle-zoomin" update=":frm"/>
                <p:commandButton value="Avançado" action="#{eventoPesquisaMB.ativarPesquisaAvancada()}" image="ui-icon ui-icon-carat-2-n-s" immediate="true" update=":frm" /> 
            </p:panel>

            <br />

            <p:dialog width="600" height="400" showHeader="false" widgetVar="dlgEvento" modal="true" closable="true" position="top">
                <h:panelGroup layout="block" id="pEvento">  
                    <p:fieldset legend="#{eventoPesquisaMB.evento.nome}">

                        <h:outputText value="Data: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.ocorrenciaDtHr}">
                            <f:convertDateTime type="date" pattern="dd/MM/yyyy" timeZone="GMT-03:00"/>
                        </h:outputText> 
                        <h:outputText value=" - "/>
                        <h:outputText value="Hora: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.ocorrenciaDtHr}">
                            <f:convertDateTime type="time" pattern="HH:mm:ss" timeZone="GMT-03:00"/>
                        </h:outputText>
                        <br />
                        <h:outputText value="Usuário do Host: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.hostUser}"/>
                        <h:outputText value=" - "/>
                        <h:outputText value="IP do Host: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.hostIp}"/>
                        <h:outputText value=" - "/>
                        <h:outputText value="Nome do Host: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.hostName}"/>
                        <br />
                        <h:outputText value="Fonte: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.fonte}"/>
                        <h:outputText value=" - "/>
                        <h:outputText value="Tipo: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.eventoTipo.descricao}"/>
                        <h:outputText value=" - "/>
                        <h:outputText value="Nível: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.eventoNivel.descricao}"/>
                        <br />
                        <h:outputText value="Palavras-Chave: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.palavrasChave}"/>
                        <br />
                        <h:outputText value="Entidade: "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.entidade.codigo}"/>
                        <h:outputText value=" - "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.entidade.cadastroNacional}"/>
                        <h:outputText value=" - "/>
                        <h:outputText value="#{eventoPesquisaMB.evento.entidade.nome}"/>
                        <br />
                        <br />
                        <h:outputText value="Descrição: "/>
                        <br />
                        <h:outputText value="#{eventoPesquisaMB.evento.mensagem}"/>

                    </p:fieldset>
                </h:panelGroup>  
                <f:facet name="footer">
                    <p:commandButton value="Fechar" onclick="dlgEvento.hide()" image="ui-icon ui-icon-arrowreturn-1-w"  style="float: right;" update="frm"/>
                </f:facet>
            </p:dialog>

            <p:fieldset legend="Lista de Eventos (Logs)">
                <h:outputText value="A pesquisa não retornou nenhum registro!" rendered="#{eventoPesquisaMB.eventos.size() == 0}" />
                <ui:repeat value="#{eventoPesquisaMB.eventos}" var="bean">
                    <div class="linha-pesquisa">
                        <h3 class="nome-link">
                            <span class="nivel#{bean.eventoNivel.codigo}">#{bean.eventoNivel.codigo}</span>

                            <p:commandLink onclick="dlgEvento.show()" update=":frm:pEvento">
                                <h:outputText value="#{bean.nome}"/>
                                <f:setPropertyActionListener target="#{eventoPesquisaMB.evento}" value="#{bean}"/> 
                            </p:commandLink>

                        </h3>
                        <p>
                            <b>Data: </b>
                            <h:outputText value="#{bean.ocorrenciaDtHr}">
                                <f:convertDateTime type="date" pattern="dd/MM/yyyy" timeZone="GMT-03:00"/>
                            </h:outputText> 
                            <b>Hora: </b>
                            <h:outputText value="#{bean.ocorrenciaDtHr}">
                                <f:convertDateTime type="time" pattern="HH:mm:ss" timeZone="GMT-03:00"/>
                            </h:outputText>
                            <b>Usuário do Host: </b>
                            <h:outputText value="#{bean.hostUser}"/>
                            <b>IP do Host: </b>
                            <h:outputText value="#{bean.hostIp}"/>
                            <b>Nome do Host: </b>
                            <h:outputText value="#{bean.hostName}"/>
                        </p>
                        <p>
                            <b>Fonte: </b>
                            <h:outputText value="#{bean.fonte}"/>
                            <b>Tipo de Evento: </b>
                            <h:outputText value="#{bean.eventoTipo.descricao}"/>
                            <b>Nível de Evento: </b>
                            <h:outputText value="#{bean.eventoNivel.descricao}"/>
                        </p>
                        <p>
                            <b>Palavras-Chave: </b>
                            <h:outputText value="#{bean.palavrasChave}"/> 
                        </p>
                        <p>
                            <b>Entidade: </b>
                            <h:outputText value="#{bean.entidade.cadastroNacional}"/> -  
                            <h:outputText value="#{bean.entidade.nome}"/> 
                        </p>
                    </div>
                </ui:repeat>
            </p:fieldset>

        </h:form>
    </ui:define>

</ui:composition>